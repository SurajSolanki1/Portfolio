<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Sword and the Stone</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.132.2';
        import { OrbitControls } from 'https://cdn.skypack.dev/three@0.132.2/examples/jsm/controls/OrbitControls.js';
        import { GLTFLoader } from 'https://cdn.skypack.dev/three@0.132.2/examples/jsm/loaders/GLTFLoader.js';

        window.onload = function() {
            // Set up the scene, camera, and renderer
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a1a);
            
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 3, 5);

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Add OrbitControls for user interaction
            const controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.maxPolarAngle = Math.PI / 2;
            controls.minDistance = 3;
            controls.maxDistance = 10;

            // Handle window resizing
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            // ------------------ LIGHTING ------------------
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 10, 5);
            scene.add(directionalLight);

            // ------------------ PLATFORM ------------------
            const textureLoader = new THREE.TextureLoader();
            
            let platformMaterial;
            try {
                const stoneTexture = textureLoader.load('stone_texture.jpg'); 
                stoneTexture.wrapS = stoneTexture.wrapT = THREE.RepeatWrapping;
                stoneTexture.repeat.set(2, 2);
                platformMaterial = new THREE.MeshStandardMaterial({ map: stoneTexture, roughness: 0.8, metalness: 0.1 });
            } catch (e) {
                console.warn("stone_texture.jpg not found. Using solid color for platform.");
                platformMaterial = new THREE.MeshStandardMaterial({ color: 0x665544, roughness: 0.8, metalness: 0.1 });
            }

            const tier1Geometry = new THREE.CylinderGeometry(2.5, 2.8, 0.5, 64);
            const tier1 = new THREE.Mesh(tier1Geometry, platformMaterial);
            tier1.position.y = -1.25;
            scene.add(tier1);

            const tier2Geometry = new THREE.CylinderGeometry(2.0, 2.3, 0.4, 64);
            const tier2 = new THREE.Mesh(tier2Geometry, platformMaterial);
            tier2.position.y = -0.7;
            scene.add(tier2);

            const tier3Geometry = new THREE.CylinderGeometry(1.5, 1.8, 0.3, 64);
            const tier3 = new THREE.Mesh(tier3Geometry, platformMaterial);
            tier3.position.y = -0.25;
            scene.add(tier3);
            
            // ------------------ SWORD (LOAD GLB MODEL) ------------------
            const loader = new GLTFLoader();
            let sword;

            loader.load(
                'sword_of_miracle_free.glb',
                function (gltf) {
                    sword = gltf.scene;
                    
                    const box = new THREE.Box3().setFromObject(sword);
                    const size = box.getSize(new THREE.Vector3());

                    console.log('Sword model loaded successfully!');
                    console.log('Model Size:', size);
                    console.log('Model Position:', sword.position);

                    sword.scale.set(0.5, 0.5, 0.5); 
                    sword.rotation.y = Math.PI; 
                    sword.position.y = 0.5;
                    
                    scene.add(sword);
                },
                undefined,
                function (error) {
                    console.error('An error happened loading the sword model:', error);
                }
            );

            // ------------------ ANIMATION LOOP ------------------
            const animate = () => {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            };

            animate();
        };
    </script>
</body>
</html>
